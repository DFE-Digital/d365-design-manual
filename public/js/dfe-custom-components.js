const c={};c.nodeListForEach=function(t,e){if(window.NodeList.prototype.forEach)return t.forEach(e);for(let s=0;s<t.length;s++)e.call(window,t[s],s,t)},c.initAll=function(t={}){const e=t.scope||document,s=e.querySelectorAll('[data-module="dfe-sortable-table"]');c.nodeListForEach(s,function(n){new c.SortableTable({table:n})});const r=e.querySelectorAll('[data-module="dfe-searchable-table"]');c.nodeListForEach(r,function(n){new c.SearchableTable({table:n})});const a=e.querySelectorAll('[data-module="dfe-filter-panel"]');c.nodeListForEach(a,function(n){new c.FilterPanel(n)});const i=e.querySelectorAll(".dfe-print-link__button");c.nodeListForEach(i,function(n){new c.PrintLink(n)})},c.SortableTable=class{constructor(t){this.table=$(t.table),!this.table.data("dfe-search-toggle-initialised")&&(this.table.data("dfe-search-toggle-initialised",!0),this.setupOptions(t),this.body=this.table.find("tbody"),this.createHeadingButtons(),this.createStatusBox(),this.initialiseSortedColumn(),this.table.on("click","th button",$.proxy(this,"onSortButtonClick")))}setupOptions(t={}){this.statusMessage=t.statusMessage||"Sort by %heading% (%direction%)",this.ascendingText=t.ascendingText||"ascending",this.descendingText=t.descendingText||"descending"}createHeadingButtons(){const t=this.table.find("thead th");for(let e=0;e<t.length;e++){const s=$(t[e]);s.attr("aria-sort")&&this.createHeadingButton(s,e)}}createHeadingButton(t,e){const s=t.text(),r=$('<button type="button" data-index="'+e+'">'+s+"</button>");t.text(""),t.append(r)}createStatusBox(){this.status=$('<div aria-live="polite" role="status" aria-atomic="true" class="govuk-visually-hidden" />'),this.table.parent().append(this.status)}initialiseSortedColumn(){const t=this.getTableRowsArray();this.table.find("th").filter('[aria-sort="ascending"], [aria-sort="descending"]').first().each((e,s)=>{const r=$(s).attr("aria-sort"),a=$(s).find("button").attr("data-index"),i=this.sort(t,a,r);this.addRows(i)})}onSortButtonClick(t){const e=t.currentTarget.getAttribute("data-index"),s=$(t.currentTarget).parent().attr("aria-sort"),r=s==="none"||s==="descending"?"ascending":"descending",a=this.getTableRowsArray(),i=this.sort(a,e,r);this.addRows(i),this.removeButtonStates(),this.updateButtonState($(t.currentTarget),r)}updateButtonState(t,e){t.parent().attr("aria-sort",e);let s=this.statusMessage;s=s.replace(/%heading%/,t.text()),s=s.replace(/%direction%/,this[e+"Text"]),this.status.text(s)}removeButtonStates(){this.table.find("thead th").attr("aria-sort","none")}addRows(t){for(let e=0;e<t.length;e++)this.body.append(t[e])}getTableRowsArray(){const t=[],e=this.body.find("tr");for(let s=0;s<e.length;s++)t.push(e[s]);return t}sort(t,e,s){return t.sort($.proxy(function(r,a){const i=$(r).find("td,th").eq(e),n=$(a).find("td,th").eq(e),l=this.getCellValue(i),o=this.getCellValue(n);return s==="ascending"?l<o?-1:l>o?1:0:o<l?-1:o>l?1:0},this))}getCellValue(t){let e=t.attr("data-sort-value")||t.html();return $.isNumeric(e)&&(e=parseInt(e,10)),e}},c.SearchableTable=class{constructor(t){if(this.table=$(t.table),this.table.data("dfe-search-toggle-initialised"))return;this.table.data("dfe-search-toggle-initialised",!0),this.setupOptions(t),this.body=this.table.find("tbody"),this.createStatusBox(),this.initialiseSortedColumn(),this.table.on("click","th button",$.proxy(this,"onSortButtonClick"));const e=document.getElementById("searchInput"),s=document.getElementById("filterTable"),r=Array.prototype.slice.call(s.querySelectorAll("tbody tr")),a=i=>{const n=i.target.value.toLowerCase();r.forEach(l=>{l.classList.add("hidden"),Array.prototype.slice.call(l.getElementsByTagName("td")).forEach(u=>{u.innerText.toLowerCase().indexOf(n)>-1&&l.classList.remove("hidden")})})};e&&e.addEventListener("input",a)}setupOptions(t={}){this.statusMessage=t.statusMessage||"Searching %searchValue%"}createStatusBox(){this.status=$('<div aria-live="polite" role="status" aria-atomic="true" class="govuk-visually-hidden" />'),this.table.parent().append(this.status)}initialiseSortedColumn(){const t=this.getTableRowsArray();this.table.find("th").filter('[aria-sort="ascending"], [aria-sort="descending"]').first().each((e,s)=>{const r=$(s).attr("aria-sort"),a=$(s).find("button").attr("data-index"),i=this.sort(t,a,r);this.addRows(i)})}onSortButtonClick(t){const e=t.currentTarget.getAttribute("data-index"),s=$(t.currentTarget).parent().attr("aria-sort"),r=s==="none"||s==="descending"?"ascending":"descending",a=this.getTableRowsArray(),i=this.sort(a,e,r);this.addRows(i),this.removeButtonStates(),this.updateButtonState($(t.currentTarget),r)}updateButtonState(t,e){t.parent().attr("aria-sort",e);let s=this.statusMessage;s=s.replace(/%heading%/,t.text()),s=s.replace(/%direction%/,this[e+"Text"]),this.status.text(s)}removeButtonStates(){this.table.find("thead th").attr("aria-sort","none")}addRows(t){for(let e=0;e<t.length;e++)this.body.append(t[e])}getTableRowsArray(){const t=[],e=this.body.find("tr");for(let s=0;s<e.length;s++)t.push(e[s]);return t}sort(t,e,s){return t.sort($.proxy(function(r,a){const i=$(r).find("td,th").eq(e),n=$(a).find("td,th").eq(e),l=this.getCellValue(i),o=this.getCellValue(n);return s==="ascending"?l<o?-1:l>o?1:0:o<l?-1:o>l?1:0},this))}getCellValue(t){let e=t.attr("data-sort-value")||t.html();return $.isNumeric(e)&&(e=parseInt(e,10)),e}},c.FilterPanel=class{constructor(t){this.$module=t,this.$headerButton=this.$module.querySelector(".dfe-filter-panel__button")||this.$module.querySelector(".dfe-filter-panel__header-button"),this.$content=this.$module.querySelector(".dfe-filter-panel__content"),this.$groupButtons=this.$module.querySelectorAll(".dfe-filter-panel__group-button"),this.$applyButton=this.$module.querySelector(".dfe-filter-panel__action--submit"),this.$selectedSection=null,this.$filterSummary=null,this.$statusRegion=null,this.init()}init(){this.$module&&(this.$headerButton&&this.$content&&this.$headerButton.addEventListener("click",this.toggleMainPanel.bind(this)),c.nodeListForEach(this.$groupButtons,t=>{t.addEventListener("click",this.toggleGroup.bind(this,t))}),this.$applyButton&&this.$applyButton.addEventListener("click",this.applyFilters.bind(this)),this.ensureSelectedSection(),this.ensureFilterSummary(),this.ensureStatusRegion(),this.$module.addEventListener("click",t=>{const e=t.target.closest(".dfe-filter-panel__tag");e&&this.removeTag(e,t)}),this.$module.addEventListener("change",t=>{t.target.matches('input[type="checkbox"], input[type="radio"], select')&&this.updateSelectedFiltersRealTime()}),this.$module.addEventListener("input",t=>{t.target.closest(".govuk-date-input")&&this.updateSelectedFiltersRealTime()}),this.$module.addEventListener("keydown",t=>{t.key==="Escape"&&this.$content&&!this.$content.hidden&&(this.collapseMainPanel(),this.$headerButton&&this.$headerButton.focus())}),this.initFromUrlParams())}initFromUrlParams(){const t=new URLSearchParams(window.location.search);let e=!1;const s=this.$module.querySelectorAll('input[type="checkbox"], input[type="radio"]');c.nodeListForEach(s,i=>{const n=i.getAttribute("name").replace("[]",""),l=i.value,o=t.getAll(n).concat(t.getAll(n+"[]"));if(i.type==="radio"){if(o.includes(l)){i.checked=!0;const u=i.closest("fieldset");(u?u.querySelector('input[type="radio"]'):null)!==i&&(e=!0)}}else o.includes(l)&&(i.checked=!0,e=!0)});const r=this.$module.querySelectorAll("select");c.nodeListForEach(r,i=>{const n=i.getAttribute("name"),l=t.get(n);l&&(i.value=l,e=!0)});const a=this.$module.querySelectorAll(".govuk-date-input");if(c.nodeListForEach(a,i=>{const n=i.querySelector('input[name$="[day]"]'),l=i.querySelector('input[name$="[month]"]'),o=i.querySelector('input[name$="[year]"]');if(n&&l&&o){const u=n.getAttribute("name").replace("[day]",""),d=t.get(u+"[day]"),h=t.get(u+"[month]"),f=t.get(u+"[year]");d&&(n.value=d),h&&(l.value=h),f&&(o.value=f),(d||h||f)&&(e=!0)}}),e){const i=this.getFilterGroups();this.renderFilterSummary(i),this.updateResultCount()}}buildUrlParams(){const t=new URLSearchParams;new URLSearchParams(window.location.search).forEach((i,n)=>{const l=CSS.escape(n),o=this.$module.querySelector('input[name="'+l+'"], input[name="'+l+'[]"], select[name="'+l+'"], input[name="'+CSS.escape(n.replace("[]",""))+'[]"]'),u=n.match(/\[(day|month|year)\]$/);!o&&!u&&t.append(n,i)});const s=this.$module.querySelectorAll('input[type="checkbox"]:checked, input[type="radio"]:checked');c.nodeListForEach(s,i=>{const n=i.getAttribute("name"),l=i.value;if(i.type==="radio"){const o=i.closest("fieldset");(o?o.querySelector('input[type="radio"]'):null)!==i&&t.append(n.replace("[]",""),l)}else t.append(n.replace("[]","")+"[]",l)});const r=this.$module.querySelectorAll("select");c.nodeListForEach(r,i=>{i.value&&t.append(i.getAttribute("name"),i.value)});const a=this.$module.querySelectorAll(".govuk-date-input");return c.nodeListForEach(a,i=>{const n=i.querySelector('input[name$="[day]"]'),l=i.querySelector('input[name$="[month]"]'),o=i.querySelector('input[name$="[year]"]');n&&n.value&&t.append(n.getAttribute("name"),n.value),l&&l.value&&t.append(l.getAttribute("name"),l.value),o&&o.value&&t.append(o.getAttribute("name"),o.value)}),t}reloadWithParams(t){const e=window.location.pathname+(t.toString()?"?"+t.toString():"");window.location.href=e}toggleMainPanel(t){t.preventDefault();const e=this.$headerButton.getAttribute("aria-expanded")==="true";this.$headerButton.setAttribute("aria-expanded",String(!e)),this.$content.hidden=e}collapseMainPanel(){this.$headerButton&&this.$content&&(this.$headerButton.setAttribute("aria-expanded","false"),this.$content.hidden=!0)}toggleGroup(t,e){e.preventDefault();const s=t.getAttribute("aria-expanded")==="true",r=t.getAttribute("aria-controls"),a=this.$module.querySelector("#"+r);a&&(t.setAttribute("aria-expanded",String(!s)),a.hidden=s)}ensureSelectedSection(){if(this.$selectedSection=this.$module.querySelector(".dfe-filter-panel__selected"),!this.$selectedSection){this.$selectedSection=document.createElement("div"),this.$selectedSection.className="dfe-filter-panel__selected",this.$selectedSection.hidden=!0,this.$selectedSection.innerHTML=`
        <div class="dfe-filter-panel__selected-header">
          <h3 class="dfe-filter-panel__selected-heading">Selected filters</h3>
          <a href="#" class="govuk-link govuk-link--no-visited-state dfe-filter-panel__clear-all">Clear all filters</a>
        </div>
        <ul class="dfe-filter-panel__selected-categories"></ul>
      `,this.$content&&this.$content.insertBefore(this.$selectedSection,this.$content.firstChild);const t=this.$selectedSection.querySelector(".dfe-filter-panel__clear-all");t&&t.addEventListener("click",this.clearAllFilters.bind(this))}}ensureFilterSummary(){if(this.$filterSummary=this.$module.nextElementSibling,!this.$filterSummary||!this.$filterSummary.classList.contains("dfe-filter-summary")){this.$filterSummary=document.createElement("div"),this.$filterSummary.className="dfe-filter-summary",this.$filterSummary.hidden=!0,this.$filterSummary.innerHTML=`
        <h3 class="dfe-filter-summary__heading">Filters applied</h3>
        <ul class="dfe-filter-summary__remove-filters"></ul>
        <a href="#" class="govuk-link govuk-link--no-visited-state dfe-filter-summary__clear-filters">Clear all filters</a>
      `,this.$module.insertAdjacentElement("afterend",this.$filterSummary);const t=this.$filterSummary.querySelector(".dfe-filter-summary__clear-filters");t&&t.addEventListener("click",this.clearAllFilters.bind(this)),this.$filterSummary.addEventListener("click",e=>{const s=e.target.closest(".dfe-filter-summary__remove-filter");s&&this.removeSummaryTag(s,e)})}}ensureStatusRegion(){this.$statusRegion=this.$module.querySelector(".dfe-filter-panel__status"),this.$statusRegion||(this.$statusRegion=document.createElement("div"),this.$statusRegion.className="dfe-filter-panel__status govuk-visually-hidden",this.$statusRegion.setAttribute("aria-live","polite"),this.$statusRegion.setAttribute("aria-atomic","true"),this.$statusRegion.setAttribute("role","status"),this.$module.appendChild(this.$statusRegion))}announceFilterChange(t){this.$statusRegion&&(this.$statusRegion.textContent="",setTimeout(()=>{this.$statusRegion.textContent=t},100))}getFilterGroups(){const t=this.$module.querySelectorAll('input[type="checkbox"]:checked, input[type="radio"]:checked'),e=this.$module.querySelectorAll("select"),s={};c.nodeListForEach(t,a=>{const i=a.getAttribute("name").replace("[]",""),n=a.value,l=this.$module.querySelector('label[for="'+a.id+'"]'),o=l?l.textContent.trim():n,u=a.closest("details"),d=u?u.querySelector(".dfe-filter-section__summary-heading"):null,h=d?d.textContent.trim():i;s[h]||(s[h]=[]),s[h].push({name:i,value:n,label:o})}),c.nodeListForEach(e,a=>{if(a.value){const i=a.getAttribute("name"),l=a.options[a.selectedIndex].textContent.trim(),o=a.closest("details"),u=o?o.querySelector(".dfe-filter-section__summary-heading"):null,d=u?u.textContent.trim():i;s[d]||(s[d]=[]),s[d].push({name:i,value:a.value,label:l})}});const r=this.$module.querySelectorAll(".govuk-date-input");return c.nodeListForEach(r,a=>{const i=a.querySelector('input[name$="[day]"]'),n=a.querySelector('input[name$="[month]"]'),l=a.querySelector('input[name$="[year]"]');if(i&&n&&l){const o=i.value,u=n.value,d=l.value;if(o||u||d){const h=i.getAttribute("name").replace("[day]",""),f=[o,u,d].filter(Boolean).join("/"),p=a.closest("details"),g=p?p.querySelector(".dfe-filter-section__summary-heading"):null,m=g?g.textContent.trim():"Date",y=a.closest("fieldset"),S=y?y.querySelector("legend"):null,b=S?S.textContent.trim():h;s[m]||(s[m]=[]),s[m].push({name:h,value:f,label:b+": "+f,isDate:!0})}}}),s}updateSelectedFiltersRealTime(){const t=this.getFilterGroups();this.renderSelectedFilters(t);const e=this.$module.querySelector(".dfe-filter-panel__count"),s=Object.values(t).reduce((a,i)=>a+i.length,0),r=s>0?s+" filter"+(s!==1?"s":"")+" selected":"No filters selected";e&&(e.textContent=s>0?s+" filter"+(s!==1?"s":"")+" selected":"24 results"),this.announceFilterChange(r)}applyFilters(t){t.preventDefault();const e=this.buildUrlParams();this.reloadWithParams(e)}renderSelectedFilters(t){const e=this.$selectedSection.querySelector(".dfe-filter-panel__selected-categories");e.innerHTML="";const s=Object.keys(t);if(s.length===0){this.$selectedSection.hidden=!0;return}s.forEach(r=>{const a=t[r],i=document.createElement("li");i.className="dfe-filter-panel__selected-category";let n=a.map(l=>`
        <li>
          <a href="#" class="dfe-filter-panel__tag" data-filter-group="${l.name}" data-filter-value="${l.value}">
            ${l.label}
            <svg class="dfe-filter-panel__tag-remove-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12" aria-hidden="true" focusable="false">
              <path d="M11.3.7L7 5 11.3 9.3l-.7.7L6.3 5.7 2 10l-.7-.7L5.6 5 1.3.7 2 0l4.3 4.3L10.6 0z"/>
            </svg>
            <span class="govuk-visually-hidden">Remove filter</span>
          </a>
        </li>
      `).join("");i.innerHTML=`
        <span class="dfe-filter-panel__selected-category-heading">${r}</span>
        <ul class="dfe-filter-panel__tag-list">${n}</ul>
      `,e.appendChild(i)}),this.$selectedSection.hidden=!1}renderFilterSummary(t){const e=this.$filterSummary.querySelector(".dfe-filter-summary__remove-filters");e.innerHTML="";const s=[];if(Object.keys(t).forEach(r=>{t[r].forEach(a=>{s.push(a)})}),s.length===0){this.$filterSummary.hidden=!0;return}s.forEach(r=>{const a=document.createElement("li");a.innerHTML=`
        <a href="#" class="dfe-filter-summary__remove-filter" data-filter-group="${r.name}" data-filter-value="${r.value}">
          ${r.label}
        </a>
      `,e.appendChild(a)}),this.$filterSummary.hidden=!1}removeTag(t,e){e.preventDefault();const s=t.getAttribute("data-filter-value"),r=t.getAttribute("data-filter-group");this.uncheckFilter(r,s);const a=t.closest("li");a&&a.remove(),this.updateSelectedFiltersVisibility(),this.updateResultCount()}removeSummaryTag(t,e){e.preventDefault();const s=t.getAttribute("data-filter-value"),r=t.getAttribute("data-filter-group");this.uncheckFilter(r,s);const a=this.buildUrlParams();this.reloadWithParams(a)}uncheckFilter(t,e){if(e&&t){const s=this.$module.querySelector('input[name="'+t+'"][value="'+e+'"], input[name="'+t+'[]"][value="'+e+'"]');s&&(s.type==="radio"||(s.checked=!1));const r=this.$module.querySelector('select[name="'+t+'"]');r&&r.value===e&&(r.value="");const a=this.$module.querySelector('input[name="'+t+'[day]"]'),i=this.$module.querySelector('input[name="'+t+'[month]"]'),n=this.$module.querySelector('input[name="'+t+'[year]"]');(a||i||n)&&(a&&(a.value=""),i&&(i.value=""),n&&(n.value=""))}}updateResultCount(){const t=this.getFilterGroups(),e=this.$module.querySelector(".dfe-filter-panel__count");if(e){const s=Object.values(t).reduce((r,a)=>r+a.length,0);e.textContent=s>0?s+" filter"+(s!==1?"s":"")+" applied":"24 results"}}clearAllFilters(t){t.preventDefault();const e=this.$module.querySelectorAll('input[type="checkbox"]:checked');c.nodeListForEach(e,n=>{n.checked=!1});const s=this.$module.querySelectorAll("fieldset");c.nodeListForEach(s,n=>{const l=n.querySelector('input[type="radio"]');l&&(l.checked=!0)});const r=this.$module.querySelectorAll("select");c.nodeListForEach(r,n=>{n.selectedIndex=0});const a=this.$module.querySelectorAll('.govuk-date-input input[type="text"]');c.nodeListForEach(a,n=>{n.value=""});const i=this.buildUrlParams();this.reloadWithParams(i)}updateSelectedFiltersVisibility(){if(!this.$selectedSection)return;const t=this.$selectedSection.querySelectorAll(".dfe-filter-panel__selected-category");let e=!1;c.nodeListForEach(t,s=>{s.querySelectorAll(".dfe-filter-panel__tag").length===0?s.remove():e=!0}),e||(this.$selectedSection.hidden=!0)}},c.PrintLink=class{constructor(t){this.$button=t,!this.$button.dataset.dfePrintLinkInitialised&&(this.$button.dataset.dfePrintLinkInitialised="true",this.$button.addEventListener("click",this.onClick.bind(this)))}onClick(t){t.preventDefault(),window.print()}};export{c as DfEComponents};
//# sourceMappingURL=dfe-custom-components.js.map
