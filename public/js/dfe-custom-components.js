const c={};c.nodeListForEach=function(e,t){if(window.NodeList.prototype.forEach)return e.forEach(t);for(let s=0;s<e.length;s++)t.call(window,e[s],s,e)},c.initAll=function(e={}){const t=e.scope||document,s=t.querySelectorAll('[data-module="dfe-sortable-table"]');c.nodeListForEach(s,function(i){new c.SortableTable({table:i})});const n=t.querySelectorAll('[data-module="dfe-searchable-table"]');c.nodeListForEach(n,function(i){new c.SearchableTable({table:i})});const a=t.querySelectorAll('[data-module="dfe-filter-panel"]');c.nodeListForEach(a,function(i){new c.FilterPanel(i)})},c.SortableTable=class{constructor(e){this.table=$(e.table),!this.table.data("dfe-search-toggle-initialised")&&(this.table.data("dfe-search-toggle-initialised",!0),this.setupOptions(e),this.body=this.table.find("tbody"),this.createHeadingButtons(),this.createStatusBox(),this.initialiseSortedColumn(),this.table.on("click","th button",$.proxy(this,"onSortButtonClick")))}setupOptions(e={}){this.statusMessage=e.statusMessage||"Sort by %heading% (%direction%)",this.ascendingText=e.ascendingText||"ascending",this.descendingText=e.descendingText||"descending"}createHeadingButtons(){const e=this.table.find("thead th");for(let t=0;t<e.length;t++){const s=$(e[t]);s.attr("aria-sort")&&this.createHeadingButton(s,t)}}createHeadingButton(e,t){const s=e.text(),n=$('<button type="button" data-index="'+t+'">'+s+"</button>");e.text(""),e.append(n)}createStatusBox(){this.status=$('<div aria-live="polite" role="status" aria-atomic="true" class="govuk-visually-hidden" />'),this.table.parent().append(this.status)}initialiseSortedColumn(){const e=this.getTableRowsArray();this.table.find("th").filter('[aria-sort="ascending"], [aria-sort="descending"]').first().each((t,s)=>{const n=$(s).attr("aria-sort"),a=$(s).find("button").attr("data-index"),i=this.sort(e,a,n);this.addRows(i)})}onSortButtonClick(e){const t=e.currentTarget.getAttribute("data-index"),s=$(e.currentTarget).parent().attr("aria-sort"),n=s==="none"||s==="descending"?"ascending":"descending",a=this.getTableRowsArray(),i=this.sort(a,t,n);this.addRows(i),this.removeButtonStates(),this.updateButtonState($(e.currentTarget),n)}updateButtonState(e,t){e.parent().attr("aria-sort",t);let s=this.statusMessage;s=s.replace(/%heading%/,e.text()),s=s.replace(/%direction%/,this[t+"Text"]),this.status.text(s)}removeButtonStates(){this.table.find("thead th").attr("aria-sort","none")}addRows(e){for(let t=0;t<e.length;t++)this.body.append(e[t])}getTableRowsArray(){const e=[],t=this.body.find("tr");for(let s=0;s<t.length;s++)e.push(t[s]);return e}sort(e,t,s){return e.sort($.proxy(function(n,a){const i=$(n).find("td,th").eq(t),l=$(a).find("td,th").eq(t),r=this.getCellValue(i),o=this.getCellValue(l);return s==="ascending"?r<o?-1:r>o?1:0:o<r?-1:o>r?1:0},this))}getCellValue(e){let t=e.attr("data-sort-value")||e.html();return $.isNumeric(t)&&(t=parseInt(t,10)),t}},c.SearchableTable=class{constructor(e){if(this.table=$(e.table),this.table.data("dfe-search-toggle-initialised"))return;this.table.data("dfe-search-toggle-initialised",!0),this.setupOptions(e),this.body=this.table.find("tbody"),this.createStatusBox(),this.initialiseSortedColumn(),this.table.on("click","th button",$.proxy(this,"onSortButtonClick"));const t=document.getElementById("searchInput"),s=document.getElementById("filterTable"),n=Array.prototype.slice.call(s.querySelectorAll("tbody tr")),a=i=>{const l=i.target.value.toLowerCase();n.forEach(r=>{r.classList.add("hidden"),Array.prototype.slice.call(r.getElementsByTagName("td")).forEach(u=>{u.innerText.toLowerCase().indexOf(l)>-1&&r.classList.remove("hidden")})})};t&&t.addEventListener("input",a)}setupOptions(e={}){this.statusMessage=e.statusMessage||"Searching %searchValue%"}createStatusBox(){this.status=$('<div aria-live="polite" role="status" aria-atomic="true" class="govuk-visually-hidden" />'),this.table.parent().append(this.status)}initialiseSortedColumn(){const e=this.getTableRowsArray();this.table.find("th").filter('[aria-sort="ascending"], [aria-sort="descending"]').first().each((t,s)=>{const n=$(s).attr("aria-sort"),a=$(s).find("button").attr("data-index"),i=this.sort(e,a,n);this.addRows(i)})}onSortButtonClick(e){const t=e.currentTarget.getAttribute("data-index"),s=$(e.currentTarget).parent().attr("aria-sort"),n=s==="none"||s==="descending"?"ascending":"descending",a=this.getTableRowsArray(),i=this.sort(a,t,n);this.addRows(i),this.removeButtonStates(),this.updateButtonState($(e.currentTarget),n)}updateButtonState(e,t){e.parent().attr("aria-sort",t);let s=this.statusMessage;s=s.replace(/%heading%/,e.text()),s=s.replace(/%direction%/,this[t+"Text"]),this.status.text(s)}removeButtonStates(){this.table.find("thead th").attr("aria-sort","none")}addRows(e){for(let t=0;t<e.length;t++)this.body.append(e[t])}getTableRowsArray(){const e=[],t=this.body.find("tr");for(let s=0;s<t.length;s++)e.push(t[s]);return e}sort(e,t,s){return e.sort($.proxy(function(n,a){const i=$(n).find("td,th").eq(t),l=$(a).find("td,th").eq(t),r=this.getCellValue(i),o=this.getCellValue(l);return s==="ascending"?r<o?-1:r>o?1:0:o<r?-1:o>r?1:0},this))}getCellValue(e){let t=e.attr("data-sort-value")||e.html();return $.isNumeric(t)&&(t=parseInt(t,10)),t}},c.FilterPanel=class{constructor(e){this.$module=e,this.$headerButton=this.$module.querySelector(".dfe-filter-panel__button")||this.$module.querySelector(".dfe-filter-panel__header-button"),this.$content=this.$module.querySelector(".dfe-filter-panel__content"),this.$groupButtons=this.$module.querySelectorAll(".dfe-filter-panel__group-button"),this.$applyButton=this.$module.querySelector(".dfe-filter-panel__action--submit"),this.$selectedSection=null,this.$filterSummary=null,this.$statusRegion=null,this.init()}init(){this.$module&&(this.$headerButton&&this.$content&&this.$headerButton.addEventListener("click",this.toggleMainPanel.bind(this)),c.nodeListForEach(this.$groupButtons,e=>{e.addEventListener("click",this.toggleGroup.bind(this,e))}),this.$applyButton&&this.$applyButton.addEventListener("click",this.applyFilters.bind(this)),this.ensureSelectedSection(),this.ensureFilterSummary(),this.ensureStatusRegion(),this.$module.addEventListener("click",e=>{const t=e.target.closest(".dfe-filter-panel__tag");t&&this.removeTag(t,e)}),this.$module.addEventListener("change",e=>{e.target.matches('input[type="checkbox"], input[type="radio"], select')&&this.updateSelectedFiltersRealTime()}),this.$module.addEventListener("input",e=>{e.target.closest(".govuk-date-input")&&this.updateSelectedFiltersRealTime()}),this.$module.addEventListener("keydown",e=>{e.key==="Escape"&&this.$content&&!this.$content.hidden&&(this.collapseMainPanel(),this.$headerButton&&this.$headerButton.focus())}),this.initFromUrlParams())}initFromUrlParams(){const e=new URLSearchParams(window.location.search);let t=!1;const s=this.$module.querySelectorAll('input[type="checkbox"], input[type="radio"]');c.nodeListForEach(s,i=>{const l=i.getAttribute("name").replace("[]",""),r=i.value,o=e.getAll(l).concat(e.getAll(l+"[]"));if(i.type==="radio"){if(o.includes(r)){i.checked=!0;const u=i.closest("fieldset");(u?u.querySelector('input[type="radio"]'):null)!==i&&(t=!0)}}else o.includes(r)&&(i.checked=!0,t=!0)});const n=this.$module.querySelectorAll("select");c.nodeListForEach(n,i=>{const l=i.getAttribute("name"),r=e.get(l);r&&(i.value=r,t=!0)});const a=this.$module.querySelectorAll(".govuk-date-input");if(c.nodeListForEach(a,i=>{const l=i.querySelector('input[name$="[day]"]'),r=i.querySelector('input[name$="[month]"]'),o=i.querySelector('input[name$="[year]"]');if(l&&r&&o){const u=l.getAttribute("name").replace("[day]",""),d=e.get(u+"[day]"),h=e.get(u+"[month]"),f=e.get(u+"[year]");d&&(l.value=d),h&&(r.value=h),f&&(o.value=f),(d||h||f)&&(t=!0)}}),t){const i=this.getFilterGroups();this.renderFilterSummary(i),this.updateResultCount()}}buildUrlParams(){const e=new URLSearchParams;new URLSearchParams(window.location.search).forEach((i,l)=>{const r=CSS.escape(l),o=this.$module.querySelector('input[name="'+r+'"], input[name="'+r+'[]"], select[name="'+r+'"], input[name="'+CSS.escape(l.replace("[]",""))+'[]"]'),u=l.match(/\[(day|month|year)\]$/);!o&&!u&&e.append(l,i)});const s=this.$module.querySelectorAll('input[type="checkbox"]:checked, input[type="radio"]:checked');c.nodeListForEach(s,i=>{const l=i.getAttribute("name"),r=i.value;if(i.type==="radio"){const o=i.closest("fieldset");(o?o.querySelector('input[type="radio"]'):null)!==i&&e.append(l.replace("[]",""),r)}else e.append(l.replace("[]","")+"[]",r)});const n=this.$module.querySelectorAll("select");c.nodeListForEach(n,i=>{i.value&&e.append(i.getAttribute("name"),i.value)});const a=this.$module.querySelectorAll(".govuk-date-input");return c.nodeListForEach(a,i=>{const l=i.querySelector('input[name$="[day]"]'),r=i.querySelector('input[name$="[month]"]'),o=i.querySelector('input[name$="[year]"]');l&&l.value&&e.append(l.getAttribute("name"),l.value),r&&r.value&&e.append(r.getAttribute("name"),r.value),o&&o.value&&e.append(o.getAttribute("name"),o.value)}),e}reloadWithParams(e){const t=window.location.pathname+(e.toString()?"?"+e.toString():"");window.location.href=t}toggleMainPanel(e){e.preventDefault();const t=this.$headerButton.getAttribute("aria-expanded")==="true";this.$headerButton.setAttribute("aria-expanded",String(!t)),this.$content.hidden=t}collapseMainPanel(){this.$headerButton&&this.$content&&(this.$headerButton.setAttribute("aria-expanded","false"),this.$content.hidden=!0)}toggleGroup(e,t){t.preventDefault();const s=e.getAttribute("aria-expanded")==="true",n=e.getAttribute("aria-controls"),a=this.$module.querySelector("#"+n);a&&(e.setAttribute("aria-expanded",String(!s)),a.hidden=s)}ensureSelectedSection(){if(this.$selectedSection=this.$module.querySelector(".dfe-filter-panel__selected"),!this.$selectedSection){this.$selectedSection=document.createElement("div"),this.$selectedSection.className="dfe-filter-panel__selected",this.$selectedSection.hidden=!0,this.$selectedSection.innerHTML=`
        <div class="dfe-filter-panel__selected-header">
          <h3 class="dfe-filter-panel__selected-heading">Selected filters</h3>
          <a href="#" class="govuk-link govuk-link--no-visited-state dfe-filter-panel__clear-all">Clear all filters</a>
        </div>
        <ul class="dfe-filter-panel__selected-categories"></ul>
      `,this.$content&&this.$content.insertBefore(this.$selectedSection,this.$content.firstChild);const e=this.$selectedSection.querySelector(".dfe-filter-panel__clear-all");e&&e.addEventListener("click",this.clearAllFilters.bind(this))}}ensureFilterSummary(){if(this.$filterSummary=this.$module.nextElementSibling,!this.$filterSummary||!this.$filterSummary.classList.contains("dfe-filter-summary")){this.$filterSummary=document.createElement("div"),this.$filterSummary.className="dfe-filter-summary",this.$filterSummary.hidden=!0,this.$filterSummary.innerHTML=`
        <h3 class="dfe-filter-summary__heading">Filters applied</h3>
        <ul class="dfe-filter-summary__remove-filters"></ul>
        <a href="#" class="govuk-link govuk-link--no-visited-state dfe-filter-summary__clear-filters">Clear all filters</a>
      `,this.$module.insertAdjacentElement("afterend",this.$filterSummary);const e=this.$filterSummary.querySelector(".dfe-filter-summary__clear-filters");e&&e.addEventListener("click",this.clearAllFilters.bind(this)),this.$filterSummary.addEventListener("click",t=>{const s=t.target.closest(".dfe-filter-summary__remove-filter");s&&this.removeSummaryTag(s,t)})}}ensureStatusRegion(){this.$statusRegion=this.$module.querySelector(".dfe-filter-panel__status"),this.$statusRegion||(this.$statusRegion=document.createElement("div"),this.$statusRegion.className="dfe-filter-panel__status govuk-visually-hidden",this.$statusRegion.setAttribute("aria-live","polite"),this.$statusRegion.setAttribute("aria-atomic","true"),this.$statusRegion.setAttribute("role","status"),this.$module.appendChild(this.$statusRegion))}announceFilterChange(e){this.$statusRegion&&(this.$statusRegion.textContent="",setTimeout(()=>{this.$statusRegion.textContent=e},100))}getFilterGroups(){const e=this.$module.querySelectorAll('input[type="checkbox"]:checked, input[type="radio"]:checked'),t=this.$module.querySelectorAll("select"),s={};c.nodeListForEach(e,a=>{const i=a.getAttribute("name").replace("[]",""),l=a.value,r=this.$module.querySelector('label[for="'+a.id+'"]'),o=r?r.textContent.trim():l,u=a.closest("details"),d=u?u.querySelector(".dfe-filter-section__summary-heading"):null,h=d?d.textContent.trim():i;s[h]||(s[h]=[]),s[h].push({name:i,value:l,label:o})}),c.nodeListForEach(t,a=>{if(a.value){const i=a.getAttribute("name"),r=a.options[a.selectedIndex].textContent.trim(),o=a.closest("details"),u=o?o.querySelector(".dfe-filter-section__summary-heading"):null,d=u?u.textContent.trim():i;s[d]||(s[d]=[]),s[d].push({name:i,value:a.value,label:r})}});const n=this.$module.querySelectorAll(".govuk-date-input");return c.nodeListForEach(n,a=>{const i=a.querySelector('input[name$="[day]"]'),l=a.querySelector('input[name$="[month]"]'),r=a.querySelector('input[name$="[year]"]');if(i&&l&&r){const o=i.value,u=l.value,d=r.value;if(o||u||d){const h=i.getAttribute("name").replace("[day]",""),f=[o,u,d].filter(Boolean).join("/"),p=a.closest("details"),g=p?p.querySelector(".dfe-filter-section__summary-heading"):null,m=g?g.textContent.trim():"Date",y=a.closest("fieldset"),S=y?y.querySelector("legend"):null,b=S?S.textContent.trim():h;s[m]||(s[m]=[]),s[m].push({name:h,value:f,label:b+": "+f,isDate:!0})}}}),s}updateSelectedFiltersRealTime(){const e=this.getFilterGroups();this.renderSelectedFilters(e);const t=this.$module.querySelector(".dfe-filter-panel__count"),s=Object.values(e).reduce((a,i)=>a+i.length,0),n=s>0?s+" filter"+(s!==1?"s":"")+" selected":"No filters selected";t&&(t.textContent=s>0?s+" filter"+(s!==1?"s":"")+" selected":"24 results"),this.announceFilterChange(n)}applyFilters(e){e.preventDefault();const t=this.buildUrlParams();this.reloadWithParams(t)}renderSelectedFilters(e){const t=this.$selectedSection.querySelector(".dfe-filter-panel__selected-categories");t.innerHTML="";const s=Object.keys(e);if(s.length===0){this.$selectedSection.hidden=!0;return}s.forEach(n=>{const a=e[n],i=document.createElement("li");i.className="dfe-filter-panel__selected-category";let l=a.map(r=>`
        <li>
          <a href="#" class="dfe-filter-panel__tag" data-filter-group="${r.name}" data-filter-value="${r.value}">
            ${r.label}
            <svg class="dfe-filter-panel__tag-remove-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12" aria-hidden="true" focusable="false">
              <path d="M11.3.7L7 5 11.3 9.3l-.7.7L6.3 5.7 2 10l-.7-.7L5.6 5 1.3.7 2 0l4.3 4.3L10.6 0z"/>
            </svg>
            <span class="govuk-visually-hidden">Remove filter</span>
          </a>
        </li>
      `).join("");i.innerHTML=`
        <span class="dfe-filter-panel__selected-category-heading">${n}</span>
        <ul class="dfe-filter-panel__tag-list">${l}</ul>
      `,t.appendChild(i)}),this.$selectedSection.hidden=!1}renderFilterSummary(e){const t=this.$filterSummary.querySelector(".dfe-filter-summary__remove-filters");t.innerHTML="";const s=[];if(Object.keys(e).forEach(n=>{e[n].forEach(a=>{s.push(a)})}),s.length===0){this.$filterSummary.hidden=!0;return}s.forEach(n=>{const a=document.createElement("li");a.innerHTML=`
        <a href="#" class="dfe-filter-summary__remove-filter" data-filter-group="${n.name}" data-filter-value="${n.value}">
          ${n.label}
        </a>
      `,t.appendChild(a)}),this.$filterSummary.hidden=!1}removeTag(e,t){t.preventDefault();const s=e.getAttribute("data-filter-value"),n=e.getAttribute("data-filter-group");this.uncheckFilter(n,s);const a=e.closest("li");a&&a.remove(),this.updateSelectedFiltersVisibility(),this.updateResultCount()}removeSummaryTag(e,t){t.preventDefault();const s=e.getAttribute("data-filter-value"),n=e.getAttribute("data-filter-group");this.uncheckFilter(n,s);const a=this.buildUrlParams();this.reloadWithParams(a)}uncheckFilter(e,t){if(t&&e){const s=this.$module.querySelector('input[name="'+e+'"][value="'+t+'"], input[name="'+e+'[]"][value="'+t+'"]');s&&(s.type==="radio"||(s.checked=!1));const n=this.$module.querySelector('select[name="'+e+'"]');n&&n.value===t&&(n.value="");const a=this.$module.querySelector('input[name="'+e+'[day]"]'),i=this.$module.querySelector('input[name="'+e+'[month]"]'),l=this.$module.querySelector('input[name="'+e+'[year]"]');(a||i||l)&&(a&&(a.value=""),i&&(i.value=""),l&&(l.value=""))}}updateResultCount(){const e=this.getFilterGroups(),t=this.$module.querySelector(".dfe-filter-panel__count");if(t){const s=Object.values(e).reduce((n,a)=>n+a.length,0);t.textContent=s>0?s+" filter"+(s!==1?"s":"")+" applied":"24 results"}}clearAllFilters(e){e.preventDefault();const t=this.$module.querySelectorAll('input[type="checkbox"]:checked');c.nodeListForEach(t,l=>{l.checked=!1});const s=this.$module.querySelectorAll("fieldset");c.nodeListForEach(s,l=>{const r=l.querySelector('input[type="radio"]');r&&(r.checked=!0)});const n=this.$module.querySelectorAll("select");c.nodeListForEach(n,l=>{l.selectedIndex=0});const a=this.$module.querySelectorAll('.govuk-date-input input[type="text"]');c.nodeListForEach(a,l=>{l.value=""});const i=this.buildUrlParams();this.reloadWithParams(i)}updateSelectedFiltersVisibility(){if(!this.$selectedSection)return;const e=this.$selectedSection.querySelectorAll(".dfe-filter-panel__selected-category");let t=!1;c.nodeListForEach(e,s=>{s.querySelectorAll(".dfe-filter-panel__tag").length===0?s.remove():t=!0}),t||(this.$selectedSection.hidden=!0)}};export{c as DfEComponents};
//# sourceMappingURL=dfe-custom-components.js.map
