const l={};l.nodeListForEach=function(t,e){if(window.NodeList.prototype.forEach)return t.forEach(e);for(let s=0;s<t.length;s++)e.call(window,t[s],s,t)},l.initAll=function(t={}){const e=t.scope||document,s=e.querySelectorAll('[data-module="dfe-sortable-table"]');l.nodeListForEach(s,function(i){new l.SortableTable({table:i})});const a=e.querySelectorAll('[data-module="dfe-searchable-table"]');l.nodeListForEach(a,function(i){new l.SearchableTable({table:i})})},l.SortableTable=class{constructor(t){this.table=$(t.table),!this.table.data("dfe-search-toggle-initialised")&&(this.table.data("dfe-search-toggle-initialised",!0),this.setupOptions(t),this.body=this.table.find("tbody"),this.createHeadingButtons(),this.createStatusBox(),this.initialiseSortedColumn(),this.table.on("click","th button",$.proxy(this,"onSortButtonClick")))}setupOptions(t={}){this.statusMessage=t.statusMessage||"Sort by %heading% (%direction%)",this.ascendingText=t.ascendingText||"ascending",this.descendingText=t.descendingText||"descending"}createHeadingButtons(){const t=this.table.find("thead th");for(let e=0;e<t.length;e++){const s=$(t[e]);s.attr("aria-sort")&&this.createHeadingButton(s,e)}}createHeadingButton(t,e){const s=t.text(),a=$('<button type="button" data-index="'+e+'">'+s+"</button>");t.text(""),t.append(a)}createStatusBox(){this.status=$('<div aria-live="polite" role="status" aria-atomic="true" class="govuk-visually-hidden" />'),this.table.parent().append(this.status)}initialiseSortedColumn(){const t=this.getTableRowsArray();this.table.find("th").filter('[aria-sort="ascending"], [aria-sort="descending"]').first().each((e,s)=>{const a=$(s).attr("aria-sort"),i=$(s).find("button").attr("data-index"),n=this.sort(t,i,a);this.addRows(n)})}onSortButtonClick(t){const e=t.currentTarget.getAttribute("data-index"),s=$(t.currentTarget).parent().attr("aria-sort"),a=s==="none"||s==="descending"?"ascending":"descending",i=this.getTableRowsArray(),n=this.sort(i,e,a);this.addRows(n),this.removeButtonStates(),this.updateButtonState($(t.currentTarget),a)}updateButtonState(t,e){t.parent().attr("aria-sort",e);let s=this.statusMessage;s=s.replace(/%heading%/,t.text()),s=s.replace(/%direction%/,this[e+"Text"]),this.status.text(s)}removeButtonStates(){this.table.find("thead th").attr("aria-sort","none")}addRows(t){for(let e=0;e<t.length;e++)this.body.append(t[e])}getTableRowsArray(){const t=[],e=this.body.find("tr");for(let s=0;s<e.length;s++)t.push(e[s]);return t}sort(t,e,s){return t.sort($.proxy(function(a,i){const n=$(a).find("td,th").eq(e),d=$(i).find("td,th").eq(e),r=this.getCellValue(n),o=this.getCellValue(d);return s==="ascending"?r<o?-1:r>o?1:0:o<r?-1:o>r?1:0},this))}getCellValue(t){let e=t.attr("data-sort-value")||t.html();return $.isNumeric(e)&&(e=parseInt(e,10)),e}},l.SearchableTable=class{constructor(t){if(this.table=$(t.table),this.table.data("dfe-search-toggle-initialised"))return;this.table.data("dfe-search-toggle-initialised",!0),this.setupOptions(t),this.body=this.table.find("tbody"),this.createStatusBox(),this.initialiseSortedColumn(),this.table.on("click","th button",$.proxy(this,"onSortButtonClick"));const e=document.getElementById("searchInput"),s=document.getElementById("filterTable"),a=Array.prototype.slice.call(s.querySelectorAll("tbody tr")),i=n=>{const d=n.target.value.toLowerCase();a.forEach(r=>{r.classList.add("hidden"),Array.prototype.slice.call(r.getElementsByTagName("td")).forEach(c=>{c.innerText.toLowerCase().indexOf(d)>-1&&r.classList.remove("hidden")})})};e&&e.addEventListener("input",i)}setupOptions(t={}){this.statusMessage=t.statusMessage||"Searching %searchValue%"}createStatusBox(){this.status=$('<div aria-live="polite" role="status" aria-atomic="true" class="govuk-visually-hidden" />'),this.table.parent().append(this.status)}initialiseSortedColumn(){const t=this.getTableRowsArray();this.table.find("th").filter('[aria-sort="ascending"], [aria-sort="descending"]').first().each((e,s)=>{const a=$(s).attr("aria-sort"),i=$(s).find("button").attr("data-index"),n=this.sort(t,i,a);this.addRows(n)})}onSortButtonClick(t){const e=t.currentTarget.getAttribute("data-index"),s=$(t.currentTarget).parent().attr("aria-sort"),a=s==="none"||s==="descending"?"ascending":"descending",i=this.getTableRowsArray(),n=this.sort(i,e,a);this.addRows(n),this.removeButtonStates(),this.updateButtonState($(t.currentTarget),a)}updateButtonState(t,e){t.parent().attr("aria-sort",e);let s=this.statusMessage;s=s.replace(/%heading%/,t.text()),s=s.replace(/%direction%/,this[e+"Text"]),this.status.text(s)}removeButtonStates(){this.table.find("thead th").attr("aria-sort","none")}addRows(t){for(let e=0;e<t.length;e++)this.body.append(t[e])}getTableRowsArray(){const t=[],e=this.body.find("tr");for(let s=0;s<e.length;s++)t.push(e[s]);return t}sort(t,e,s){return t.sort($.proxy(function(a,i){const n=$(a).find("td,th").eq(e),d=$(i).find("td,th").eq(e),r=this.getCellValue(n),o=this.getCellValue(d);return s==="ascending"?r<o?-1:r>o?1:0:o<r?-1:o>r?1:0},this))}getCellValue(t){let e=t.attr("data-sort-value")||t.html();return $.isNumeric(e)&&(e=parseInt(e,10)),e}};export{l as DfEComponents};
//# sourceMappingURL=dfe-custom-components.js.map
