const o={};o.nodeListForEach=function(e,t){if(window.NodeList.prototype.forEach)return e.forEach(t);for(let s=0;s<e.length;s++)t.call(window,e[s],s,e)},o.initAll=function(e={}){const t=e.scope||document,s=t.querySelectorAll('[data-module="dfe-sortable-table"]');o.nodeListForEach(s,function(r){new o.SortableTable({table:r})});const a=t.querySelectorAll('[data-module="dfe-searchable-table"]');o.nodeListForEach(a,function(r){new o.SearchableTable({table:r})});const i=t.querySelectorAll('[data-module="dfe-filter-panel"]');o.nodeListForEach(i,function(r){new o.FilterPanel(r)})},o.SortableTable=class{constructor(e){this.table=$(e.table),!this.table.data("dfe-search-toggle-initialised")&&(this.table.data("dfe-search-toggle-initialised",!0),this.setupOptions(e),this.body=this.table.find("tbody"),this.createHeadingButtons(),this.createStatusBox(),this.initialiseSortedColumn(),this.table.on("click","th button",$.proxy(this,"onSortButtonClick")))}setupOptions(e={}){this.statusMessage=e.statusMessage||"Sort by %heading% (%direction%)",this.ascendingText=e.ascendingText||"ascending",this.descendingText=e.descendingText||"descending"}createHeadingButtons(){const e=this.table.find("thead th");for(let t=0;t<e.length;t++){const s=$(e[t]);s.attr("aria-sort")&&this.createHeadingButton(s,t)}}createHeadingButton(e,t){const s=e.text(),a=$('<button type="button" data-index="'+t+'">'+s+"</button>");e.text(""),e.append(a)}createStatusBox(){this.status=$('<div aria-live="polite" role="status" aria-atomic="true" class="govuk-visually-hidden" />'),this.table.parent().append(this.status)}initialiseSortedColumn(){const e=this.getTableRowsArray();this.table.find("th").filter('[aria-sort="ascending"], [aria-sort="descending"]').first().each((t,s)=>{const a=$(s).attr("aria-sort"),i=$(s).find("button").attr("data-index"),r=this.sort(e,i,a);this.addRows(r)})}onSortButtonClick(e){const t=e.currentTarget.getAttribute("data-index"),s=$(e.currentTarget).parent().attr("aria-sort"),a=s==="none"||s==="descending"?"ascending":"descending",i=this.getTableRowsArray(),r=this.sort(i,t,a);this.addRows(r),this.removeButtonStates(),this.updateButtonState($(e.currentTarget),a)}updateButtonState(e,t){e.parent().attr("aria-sort",t);let s=this.statusMessage;s=s.replace(/%heading%/,e.text()),s=s.replace(/%direction%/,this[t+"Text"]),this.status.text(s)}removeButtonStates(){this.table.find("thead th").attr("aria-sort","none")}addRows(e){for(let t=0;t<e.length;t++)this.body.append(e[t])}getTableRowsArray(){const e=[],t=this.body.find("tr");for(let s=0;s<t.length;s++)e.push(t[s]);return e}sort(e,t,s){return e.sort($.proxy(function(a,i){const r=$(a).find("td,th").eq(t),n=$(i).find("td,th").eq(t),l=this.getCellValue(r),c=this.getCellValue(n);return s==="ascending"?l<c?-1:l>c?1:0:c<l?-1:c>l?1:0},this))}getCellValue(e){let t=e.attr("data-sort-value")||e.html();return $.isNumeric(t)&&(t=parseInt(t,10)),t}},o.SearchableTable=class{constructor(e){if(this.table=$(e.table),this.table.data("dfe-search-toggle-initialised"))return;this.table.data("dfe-search-toggle-initialised",!0),this.setupOptions(e),this.body=this.table.find("tbody"),this.createStatusBox(),this.initialiseSortedColumn(),this.table.on("click","th button",$.proxy(this,"onSortButtonClick"));const t=document.getElementById("searchInput"),s=document.getElementById("filterTable"),a=Array.prototype.slice.call(s.querySelectorAll("tbody tr")),i=r=>{const n=r.target.value.toLowerCase();a.forEach(l=>{l.classList.add("hidden"),Array.prototype.slice.call(l.getElementsByTagName("td")).forEach(d=>{d.innerText.toLowerCase().indexOf(n)>-1&&l.classList.remove("hidden")})})};t&&t.addEventListener("input",i)}setupOptions(e={}){this.statusMessage=e.statusMessage||"Searching %searchValue%"}createStatusBox(){this.status=$('<div aria-live="polite" role="status" aria-atomic="true" class="govuk-visually-hidden" />'),this.table.parent().append(this.status)}initialiseSortedColumn(){const e=this.getTableRowsArray();this.table.find("th").filter('[aria-sort="ascending"], [aria-sort="descending"]').first().each((t,s)=>{const a=$(s).attr("aria-sort"),i=$(s).find("button").attr("data-index"),r=this.sort(e,i,a);this.addRows(r)})}onSortButtonClick(e){const t=e.currentTarget.getAttribute("data-index"),s=$(e.currentTarget).parent().attr("aria-sort"),a=s==="none"||s==="descending"?"ascending":"descending",i=this.getTableRowsArray(),r=this.sort(i,t,a);this.addRows(r),this.removeButtonStates(),this.updateButtonState($(e.currentTarget),a)}updateButtonState(e,t){e.parent().attr("aria-sort",t);let s=this.statusMessage;s=s.replace(/%heading%/,e.text()),s=s.replace(/%direction%/,this[t+"Text"]),this.status.text(s)}removeButtonStates(){this.table.find("thead th").attr("aria-sort","none")}addRows(e){for(let t=0;t<e.length;t++)this.body.append(e[t])}getTableRowsArray(){const e=[],t=this.body.find("tr");for(let s=0;s<t.length;s++)e.push(t[s]);return e}sort(e,t,s){return e.sort($.proxy(function(a,i){const r=$(a).find("td,th").eq(t),n=$(i).find("td,th").eq(t),l=this.getCellValue(r),c=this.getCellValue(n);return s==="ascending"?l<c?-1:l>c?1:0:c<l?-1:c>l?1:0},this))}getCellValue(e){let t=e.attr("data-sort-value")||e.html();return $.isNumeric(t)&&(t=parseInt(t,10)),t}},o.FilterPanel=class{constructor(e){this.$module=e,this.$headerButton=this.$module.querySelector(".dfe-filter-panel__button")||this.$module.querySelector(".dfe-filter-panel__header-button"),this.$content=this.$module.querySelector(".dfe-filter-panel__content"),this.$groupButtons=this.$module.querySelectorAll(".dfe-filter-panel__group-button"),this.$applyButton=this.$module.querySelector(".dfe-filter-panel__action--submit"),this.$selectedSection=null,this.$filterSummary=null,this.init()}init(){this.$module&&(this.$headerButton&&this.$content&&this.$headerButton.addEventListener("click",this.toggleMainPanel.bind(this)),o.nodeListForEach(this.$groupButtons,e=>{e.addEventListener("click",this.toggleGroup.bind(this,e))}),this.$applyButton&&this.$applyButton.addEventListener("click",this.applyFilters.bind(this)),this.ensureSelectedSection(),this.ensureFilterSummary(),this.$module.addEventListener("click",e=>{const t=e.target.closest(".dfe-filter-panel__tag");t&&this.removeTag(t,e)}),this.$module.addEventListener("change",e=>{e.target.matches('input[type="checkbox"], input[type="radio"], select')&&this.updateSelectedFiltersRealTime()}),this.initFromUrlParams())}initFromUrlParams(){const e=new URLSearchParams(window.location.search);let t=!1;const s=this.$module.querySelectorAll('input[type="checkbox"], input[type="radio"]');o.nodeListForEach(s,i=>{const r=i.getAttribute("name").replace("[]",""),n=i.value,l=e.getAll(r).concat(e.getAll(r+"[]"));if(i.type==="radio"){if(l.includes(n)){i.checked=!0;const c=i.closest("fieldset");(c?c.querySelector('input[type="radio"]'):null)!==i&&(t=!0)}}else l.includes(n)&&(i.checked=!0,t=!0)});const a=this.$module.querySelectorAll("select");if(o.nodeListForEach(a,i=>{const r=i.getAttribute("name"),n=e.get(r);n&&(i.value=n,t=!0)}),t){const i=this.getFilterGroups();this.renderFilterSummary(i),this.updateResultCount()}}buildUrlParams(){const e=new URLSearchParams;new URLSearchParams(window.location.search).forEach((i,r)=>{this.$module.querySelector('input[name="'+r+'"], input[name="'+r+'[]"], select[name="'+r+'"], input[name="'+r.replace("[]","")+'[]"]')||e.append(r,i)});const s=this.$module.querySelectorAll('input[type="checkbox"]:checked, input[type="radio"]:checked');o.nodeListForEach(s,i=>{const r=i.getAttribute("name"),n=i.value;if(i.type==="radio"){const l=i.closest("fieldset");(l?l.querySelector('input[type="radio"]'):null)!==i&&e.append(r.replace("[]",""),n)}else e.append(r.replace("[]","")+"[]",n)});const a=this.$module.querySelectorAll("select");return o.nodeListForEach(a,i=>{i.value&&e.append(i.getAttribute("name"),i.value)}),e}reloadWithParams(e){const t=window.location.pathname+(e.toString()?"?"+e.toString():"");window.location.href=t}toggleMainPanel(e){e.preventDefault();const t=this.$headerButton.getAttribute("aria-expanded")==="true";this.$headerButton.setAttribute("aria-expanded",String(!t)),this.$content.hidden=t}collapseMainPanel(){this.$headerButton&&this.$content&&(this.$headerButton.setAttribute("aria-expanded","false"),this.$content.hidden=!0)}toggleGroup(e,t){t.preventDefault();const s=e.getAttribute("aria-expanded")==="true",a=e.getAttribute("aria-controls"),i=this.$module.querySelector("#"+a);i&&(e.setAttribute("aria-expanded",String(!s)),i.hidden=s)}ensureSelectedSection(){if(this.$selectedSection=this.$module.querySelector(".dfe-filter-panel__selected"),!this.$selectedSection){this.$selectedSection=document.createElement("div"),this.$selectedSection.className="dfe-filter-panel__selected",this.$selectedSection.hidden=!0,this.$selectedSection.innerHTML=`
        <div class="dfe-filter-panel__selected-header">
          <h3 class="dfe-filter-panel__selected-heading">Selected filters</h3>
          <a href="#" class="govuk-link govuk-link--no-visited-state dfe-filter-panel__clear-all">Clear all filters</a>
        </div>
        <ul class="dfe-filter-panel__selected-categories"></ul>
      `,this.$content&&this.$content.insertBefore(this.$selectedSection,this.$content.firstChild);const e=this.$selectedSection.querySelector(".dfe-filter-panel__clear-all");e&&e.addEventListener("click",this.clearAllFilters.bind(this))}}ensureFilterSummary(){if(this.$filterSummary=this.$module.nextElementSibling,!this.$filterSummary||!this.$filterSummary.classList.contains("dfe-filter-summary")){this.$filterSummary=document.createElement("div"),this.$filterSummary.className="dfe-filter-summary",this.$filterSummary.hidden=!0,this.$filterSummary.innerHTML=`
        <h3 class="dfe-filter-summary__heading">Filters applied</h3>
        <ul class="dfe-filter-summary__remove-filters"></ul>
        <a href="#" class="govuk-link govuk-link--no-visited-state dfe-filter-summary__clear-filters">Clear all filters</a>
      `,this.$module.insertAdjacentElement("afterend",this.$filterSummary);const e=this.$filterSummary.querySelector(".dfe-filter-summary__clear-filters");e&&e.addEventListener("click",this.clearAllFilters.bind(this)),this.$filterSummary.addEventListener("click",t=>{const s=t.target.closest(".dfe-filter-summary__remove-filter");s&&this.removeSummaryTag(s,t)})}}getFilterGroups(){const e=this.$module.querySelectorAll('input[type="checkbox"]:checked, input[type="radio"]:checked'),t=this.$module.querySelectorAll("select"),s={};return o.nodeListForEach(e,a=>{const i=a.getAttribute("name").replace("[]",""),r=a.value,n=this.$module.querySelector('label[for="'+a.id+'"]'),l=n?n.textContent.trim():r,c=a.closest("details"),d=c?c.querySelector(".dfe-filter-section__summary-heading"):null,u=d?d.textContent.trim():i;s[u]||(s[u]=[]),s[u].push({name:i,value:r,label:l})}),o.nodeListForEach(t,a=>{if(a.value){const i=a.getAttribute("name"),n=a.options[a.selectedIndex].textContent.trim(),l=a.closest("details"),c=l?l.querySelector(".dfe-filter-section__summary-heading"):null,d=c?c.textContent.trim():i;s[d]||(s[d]=[]),s[d].push({name:i,value:a.value,label:n})}}),s}updateSelectedFiltersRealTime(){const e=this.getFilterGroups();this.renderSelectedFilters(e);const t=this.$module.querySelector(".dfe-filter-panel__count");if(t){const s=Object.values(e).reduce((a,i)=>a+i.length,0);t.textContent=s>0?s+" filter"+(s!==1?"s":"")+" selected":"24 results"}}applyFilters(e){e.preventDefault();const t=this.buildUrlParams();this.reloadWithParams(t)}renderSelectedFilters(e){const t=this.$selectedSection.querySelector(".dfe-filter-panel__selected-categories");t.innerHTML="";const s=Object.keys(e);if(s.length===0){this.$selectedSection.hidden=!0;return}s.forEach(a=>{const i=e[a],r=document.createElement("li");r.className="dfe-filter-panel__selected-category";let n=i.map(l=>`
        <li>
          <a href="#" class="dfe-filter-panel__tag" data-filter-group="${l.name}" data-filter-value="${l.value}">
            ${l.label}
            <svg class="dfe-filter-panel__tag-remove-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12" aria-hidden="true" focusable="false">
              <path d="M11.3.7L7 5 11.3 9.3l-.7.7L6.3 5.7 2 10l-.7-.7L5.6 5 1.3.7 2 0l4.3 4.3L10.6 0z"/>
            </svg>
            <span class="govuk-visually-hidden">Remove filter</span>
          </a>
        </li>
      `).join("");r.innerHTML=`
        <span class="dfe-filter-panel__selected-category-heading">${a}</span>
        <ul class="dfe-filter-panel__tag-list">${n}</ul>
      `,t.appendChild(r)}),this.$selectedSection.hidden=!1}renderFilterSummary(e){const t=this.$filterSummary.querySelector(".dfe-filter-summary__remove-filters");t.innerHTML="";const s=[];if(Object.keys(e).forEach(a=>{e[a].forEach(i=>{s.push(i)})}),s.length===0){this.$filterSummary.hidden=!0;return}s.forEach(a=>{const i=document.createElement("li");i.innerHTML=`
        <a href="#" class="dfe-filter-summary__remove-filter" data-filter-group="${a.name}" data-filter-value="${a.value}">
          ${a.label}
        </a>
      `,t.appendChild(i)}),this.$filterSummary.hidden=!1}removeTag(e,t){t.preventDefault();const s=e.getAttribute("data-filter-value"),a=e.getAttribute("data-filter-group");this.uncheckFilter(a,s);const i=e.closest("li");i&&i.remove(),this.updateSelectedFiltersVisibility(),this.updateResultCount()}removeSummaryTag(e,t){t.preventDefault();const s=e.getAttribute("data-filter-value"),a=e.getAttribute("data-filter-group");this.uncheckFilter(a,s);const i=this.buildUrlParams();this.reloadWithParams(i)}uncheckFilter(e,t){if(t&&e){const s=this.$module.querySelector('input[name="'+e+'"][value="'+t+'"], input[name="'+e+'[]"][value="'+t+'"]');s&&(s.type==="radio"||(s.checked=!1));const a=this.$module.querySelector('select[name="'+e+'"]');a&&a.value===t&&(a.value="")}}updateResultCount(){const e=this.getFilterGroups(),t=this.$module.querySelector(".dfe-filter-panel__count");if(t){const s=Object.values(e).reduce((a,i)=>a+i.length,0);t.textContent=s>0?s+" filter"+(s!==1?"s":"")+" applied":"24 results"}}clearAllFilters(e){e.preventDefault();const t=this.$module.querySelectorAll('input[type="checkbox"]:checked');o.nodeListForEach(t,r=>{r.checked=!1});const s=this.$module.querySelectorAll("fieldset");o.nodeListForEach(s,r=>{const n=r.querySelector('input[type="radio"]');n&&(n.checked=!0)});const a=this.$module.querySelectorAll("select");o.nodeListForEach(a,r=>{r.selectedIndex=0});const i=this.buildUrlParams();this.reloadWithParams(i)}updateSelectedFiltersVisibility(){if(!this.$selectedSection)return;const e=this.$selectedSection.querySelectorAll(".dfe-filter-panel__selected-category");let t=!1;o.nodeListForEach(e,s=>{s.querySelectorAll(".dfe-filter-panel__tag").length===0?s.remove():t=!0}),t||(this.$selectedSection.hidden=!0)}};export{o as DfEComponents};
//# sourceMappingURL=dfe-custom-components.js.map
